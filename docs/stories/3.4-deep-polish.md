# Story 3.4: Deep Polish - Premium Details

**Story ID:** AITELIER-3.4
**Epic:** 3.0 - UX Polish Framer/Apple
**Priority:** P2
**Estimate:** 8-10 hours
**Status:** Ready for Development
**Depends on:** Stories 3.1, 3.2, 3.3

---

## User Story

**As a** discerning visitor comparing studios
**I want** to experience premium details that competitors don't have
**So that** AI.TELIER feels like a truly elite creative studio

---

## Acceptance Criteria

### AC1: Custom Cursor System
- [ ] Default cursor replaced with custom dot (desktop only)
- [ ] Cursor dot: 8px, tech-olive with slight glow
- [ ] Cursor ring: 32px, follows with slight delay (lerp)
- [ ] On hoverable elements: ring expands, shows "VIEW" or "CLICK"
- [ ] On links: ring becomes underline indicator
- [ ] Disabled on touch devices

### AC2: Magnetic Button Effect
- [ ] CTA buttons have magnetic pull toward cursor
- [ ] Effect radius: 100px from button center
- [ ] Max displacement: 10px
- [ ] Smooth return to center on mouse leave
- [ ] Spring physics for return animation

### AC3: Hero Parallax Mouse Follow
- [ ] Hero background image shifts based on mouse position
- [ ] Movement: subtle (max 20px in any direction)
- [ ] Smooth interpolation (not 1:1 with mouse)
- [ ] Effect intensity decreases on mobile (or disabled)
- [ ] Uses requestAnimationFrame for performance

### AC4: Page Transition Animations
- [ ] Route changes have fade transition
- [ ] Old page fades out (200ms)
- [ ] New page fades in (300ms)
- [ ] Optional: slide direction based on navigation
- [ ] Uses Framer Motion AnimatePresence

### AC5: Mobile Menu Stagger
- [ ] Mobile nav opens with stagger animation
- [ ] Items slide in from right, 50ms stagger
- [ ] Close: items slide out in reverse order
- [ ] Backdrop fades in/out
- [ ] Touch-friendly dismiss (swipe or tap outside)

### AC6: Input Field Enhancements
- [ ] Float labels on focus
- [ ] Border glow animation on focus
- [ ] Valid state: green accent
- [ ] Error state: red accent with shake
- [ ] Placeholder fade on focus

---

## Technical Implementation

### Task 1: Custom Cursor System

**File:** `src/components/CustomCursor.tsx` (NEW)

```tsx
import { useState, useEffect, useCallback } from "react";
import { motion, useMotionValue, useSpring } from "framer-motion";

export const CustomCursor = () => {
  const [isVisible, setIsVisible] = useState(false);
  const [cursorText, setCursorText] = useState("");
  const [isHovering, setIsHovering] = useState(false);

  // Smooth cursor position
  const cursorX = useMotionValue(0);
  const cursorY = useMotionValue(0);

  // Spring for the ring (delayed follow)
  const springConfig = { damping: 25, stiffness: 400 };
  const ringX = useSpring(cursorX, springConfig);
  const ringY = useSpring(cursorY, springConfig);

  const handleMouseMove = useCallback((e: MouseEvent) => {
    cursorX.set(e.clientX);
    cursorY.set(e.clientY);
    setIsVisible(true);
  }, [cursorX, cursorY]);

  const handleMouseLeave = useCallback(() => {
    setIsVisible(false);
  }, []);

  useEffect(() => {
    // Only enable on non-touch devices
    if (window.matchMedia("(hover: hover)").matches) {
      document.addEventListener("mousemove", handleMouseMove);
      document.addEventListener("mouseleave", handleMouseLeave);

      // Track hoverable elements
      const hoverables = document.querySelectorAll(
        "a, button, [role='button'], .cursor-pointer"
      );

      const handleEnter = (e: Event) => {
        setIsHovering(true);
        const target = e.target as HTMLElement;
        const text = target.dataset.cursorText || "";
        setCursorText(text);
      };

      const handleLeave = () => {
        setIsHovering(false);
        setCursorText("");
      };

      hoverables.forEach((el) => {
        el.addEventListener("mouseenter", handleEnter);
        el.addEventListener("mouseleave", handleLeave);
      });

      return () => {
        document.removeEventListener("mousemove", handleMouseMove);
        document.removeEventListener("mouseleave", handleMouseLeave);
        hoverables.forEach((el) => {
          el.removeEventListener("mouseenter", handleEnter);
          el.removeEventListener("mouseleave", handleLeave);
        });
      };
    }
  }, [handleMouseMove, handleMouseLeave]);

  // Hide default cursor via CSS
  useEffect(() => {
    if (window.matchMedia("(hover: hover)").matches) {
      document.body.style.cursor = "none";
      return () => {
        document.body.style.cursor = "";
      };
    }
  }, []);

  if (!isVisible) return null;

  return (
    <>
      {/* Dot (instant follow) */}
      <motion.div
        className="fixed pointer-events-none z-[9999] mix-blend-difference"
        style={{
          x: cursorX,
          y: cursorY,
          translateX: "-50%",
          translateY: "-50%",
        }}
      >
        <div className="w-2 h-2 bg-tech-olive rounded-full" />
      </motion.div>

      {/* Ring (delayed follow) */}
      <motion.div
        className="fixed pointer-events-none z-[9998]"
        style={{
          x: ringX,
          y: ringY,
          translateX: "-50%",
          translateY: "-50%",
        }}
        animate={{
          width: isHovering ? 64 : 32,
          height: isHovering ? 64 : 32,
        }}
        transition={{ type: "spring", stiffness: 300, damping: 20 }}
      >
        <div
          className="w-full h-full rounded-full border border-tech-olive/50
                    flex items-center justify-center"
        >
          {cursorText && (
            <span className="text-[10px] text-tech-olive font-mono uppercase">
              {cursorText}
            </span>
          )}
        </div>
      </motion.div>
    </>
  );
};
```

**CSS:** Add to `src/index.css`

```css
/* Hide cursor on hoverable elements when custom cursor active */
@media (hover: hover) {
  a, button, [role="button"], .cursor-pointer {
    cursor: none !important;
  }
}
```

---

### Task 2: Magnetic Button Effect

**File:** `src/components/MagneticButton.tsx` (NEW)

```tsx
import { useRef, useState } from "react";
import { motion, useMotionValue, useSpring } from "framer-motion";

interface MagneticButtonProps {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
}

export const MagneticButton = ({
  children,
  className = "",
  onClick,
}: MagneticButtonProps) => {
  const ref = useRef<HTMLButtonElement>(null);
  const [isHovered, setIsHovered] = useState(false);

  const x = useMotionValue(0);
  const y = useMotionValue(0);

  const springConfig = { stiffness: 150, damping: 15 };
  const springX = useSpring(x, springConfig);
  const springY = useSpring(y, springConfig);

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!ref.current) return;

    const rect = ref.current.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    const distanceX = e.clientX - centerX;
    const distanceY = e.clientY - centerY;

    // Calculate distance from center
    const distance = Math.sqrt(distanceX ** 2 + distanceY ** 2);
    const maxDistance = 100;

    if (distance < maxDistance) {
      // Magnetic effect - pull toward cursor
      const strength = 1 - distance / maxDistance;
      x.set(distanceX * strength * 0.3);
      y.set(distanceY * strength * 0.3);
    }
  };

  const handleMouseLeave = () => {
    x.set(0);
    y.set(0);
    setIsHovered(false);
  };

  return (
    <motion.button
      ref={ref}
      className={className}
      style={{ x: springX, y: springY }}
      onMouseMove={handleMouseMove}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={handleMouseLeave}
      onClick={onClick}
    >
      {children}
    </motion.button>
  );
};
```

---

### Task 3: Hero Parallax Mouse Follow

**File:** `src/hooks/useMouseParallax.ts` (NEW)

```tsx
import { useState, useEffect, useCallback } from "react";
import { useReducedMotion } from "./useReducedMotion";

interface ParallaxPosition {
  x: number;
  y: number;
}

export const useMouseParallax = (intensity = 20) => {
  const [position, setPosition] = useState<ParallaxPosition>({ x: 0, y: 0 });
  const prefersReducedMotion = useReducedMotion();

  const handleMouseMove = useCallback(
    (e: MouseEvent) => {
      if (prefersReducedMotion) return;

      const { clientX, clientY } = e;
      const { innerWidth, innerHeight } = window;

      // Calculate offset from center (-1 to 1)
      const offsetX = (clientX / innerWidth - 0.5) * 2;
      const offsetY = (clientY / innerHeight - 0.5) * 2;

      // Apply intensity
      setPosition({
        x: offsetX * intensity,
        y: offsetY * intensity,
      });
    },
    [intensity, prefersReducedMotion]
  );

  useEffect(() => {
    // Only on desktop
    if (window.innerWidth < 768) return;

    window.addEventListener("mousemove", handleMouseMove);
    return () => window.removeEventListener("mousemove", handleMouseMove);
  }, [handleMouseMove]);

  return position;
};
```

**File:** `src/components/HeroV2.tsx` - Apply parallax

```tsx
import { useMouseParallax } from "@/hooks/useMouseParallax";
import { motion, useSpring } from "framer-motion";

export const HeroV2 = () => {
  const parallax = useMouseParallax(20);

  const springConfig = { stiffness: 50, damping: 30 };
  const x = useSpring(parallax.x, springConfig);
  const y = useSpring(parallax.y, springConfig);

  return (
    <section className="relative min-h-screen">
      {/* Background with parallax */}
      <motion.div
        className="absolute inset-0"
        style={{ x, y, scale: 1.1 }} // Scale up to hide edges
      >
        <img src={heroImage} ... />
      </motion.div>

      {/* Content (no parallax) */}
      <div className="relative z-10">
        {/* ... */}
      </div>
    </section>
  );
};
```

---

### Task 4: Page Transition Animations

**File:** `src/components/PageTransition.tsx` (NEW)

```tsx
import { motion, AnimatePresence } from "framer-motion";
import { useLocation } from "react-router-dom";

const pageVariants = {
  initial: { opacity: 0 },
  animate: { opacity: 1 },
  exit: { opacity: 0 },
};

const pageTransition = {
  duration: 0.25,
  ease: [0.4, 0, 0.2, 1],
};

export const PageTransition = ({ children }: { children: React.ReactNode }) => {
  const location = useLocation();

  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        variants={pageVariants}
        initial="initial"
        animate="animate"
        exit="exit"
        transition={pageTransition}
      >
        {children}
      </motion.div>
    </AnimatePresence>
  );
};
```

**File:** `src/App.tsx` - Wrap routes

```tsx
import { PageTransition } from "@/components/PageTransition";

<Routes>
  <Route path="/" element={
    <PageTransition>
      <Index />
    </PageTransition>
  } />
  {/* ... other routes ... */}
</Routes>
```

---

### Task 5: Mobile Menu Stagger

**File:** `src/components/NavigationV2.tsx` - Update mobile menu

```tsx
const menuVariants = {
  closed: { opacity: 0, height: 0 },
  open: {
    opacity: 1,
    height: "auto",
    transition: {
      duration: 0.3,
      staggerChildren: 0.05,
      delayChildren: 0.1,
    },
  },
};

const itemVariants = {
  closed: { opacity: 0, x: 20 },
  open: {
    opacity: 1,
    x: 0,
    transition: { duration: 0.3 },
  },
};

// In the component
<AnimatePresence>
  {mobileMenuOpen && (
    <motion.div
      className="md:hidden bg-ancestral-black/95 backdrop-blur-xl
                border-t border-text-muted/10 overflow-hidden"
      variants={menuVariants}
      initial="closed"
      animate="open"
      exit="closed"
    >
      <div className="px-6 py-4 space-y-4">
        {navItems.map((item) => (
          <motion.div key={item.href} variants={itemVariants}>
            <Link
              to={item.href}
              className="block text-lg text-text-secondary
                        hover:text-ancestral-white transition-colors font-mono-v2"
              onClick={() => setMobileMenuOpen(false)}
            >
              {item.label}
            </Link>
          </motion.div>
        ))}
      </div>
    </motion.div>
  )}
</AnimatePresence>
```

---

### Task 6: Input Field Enhancements

**File:** `src/index.css`

```css
/* Floating Label Input */
.input-floating {
  @apply relative;
}

.input-floating input {
  @apply w-full bg-stone-dark border-2 border-concrete-border
         px-4 pt-6 pb-2 text-ancestral-white font-body
         transition-all duration-300;
}

.input-floating label {
  @apply absolute left-4 text-text-muted pointer-events-none
         transition-all duration-300;
  top: 50%;
  transform: translateY(-50%);
}

.input-floating input:focus,
.input-floating input:not(:placeholder-shown) {
  @apply border-tech-olive;
  box-shadow: 0 0 0 3px hsl(var(--matrix-green) / 0.2);
}

.input-floating input:focus + label,
.input-floating input:not(:placeholder-shown) + label {
  @apply text-tech-olive text-xs;
  top: 12px;
  transform: translateY(0);
}

/* Error state */
.input-floating.error input {
  @apply border-red-500;
  animation: shake 0.3s ease-in-out;
}

.input-floating.error label {
  @apply text-red-500;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-8px); }
  75% { transform: translateX(8px); }
}

/* Valid state */
.input-floating.valid input {
  @apply border-green-500;
}

.input-floating.valid label {
  @apply text-green-500;
}
```

---

## Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/CustomCursor.tsx` | CREATE | Custom cursor system |
| `src/components/MagneticButton.tsx` | CREATE | Magnetic button effect |
| `src/components/PageTransition.tsx` | CREATE | Route transitions |
| `src/hooks/useMouseParallax.ts` | CREATE | Mouse parallax hook |
| `src/components/HeroV2.tsx` | MODIFY | Add parallax |
| `src/components/NavigationV2.tsx` | MODIFY | Mobile menu stagger |
| `src/index.css` | MODIFY | Input styles, cursor hide |
| `src/App.tsx` | MODIFY | Add cursor, transitions |

---

## Testing Checklist

- [ ] Custom cursor smooth on desktop
- [ ] Cursor hidden on mobile/touch
- [ ] Magnetic effect feels natural
- [ ] Hero parallax is subtle, not nauseating
- [ ] Page transitions don't flash
- [ ] Mobile menu stagger timing feels good
- [ ] Input focus states work
- [ ] All effects respect reduced motion
- [ ] No performance issues

---

## Definition of Done

- [ ] All 6 acceptance criteria met
- [ ] Premium feel achieved
- [ ] Performance maintained > 60fps
- [ ] A11y not compromised
- [ ] Cross-device testing complete

---

## Notes

- Custom cursor is a "nice to have" - can be cut if time constrained
- Magnetic buttons work best on large CTAs
- Hero parallax intensity should be very subtle
- Page transitions should be fast - users hate waiting
- Test mobile menu on real devices

---

**Estimate breakdown:**
- Task 1 (Custom cursor): 2.5 hours
- Task 2 (Magnetic button): 1.5 hours
- Task 3 (Hero parallax): 1.5 hours
- Task 4 (Page transitions): 1 hour
- Task 5 (Mobile menu): 1 hour
- Task 6 (Input fields): 1 hour
- Testing & polish: 1.5 hours

**Total: ~10 hours**

---

## Cut List (if time constrained)

Priority order to cut if needed:
1. **Keep:** Page transitions, Mobile menu (highest impact)
2. **Maybe cut:** Input enhancements (can do later)
3. **Maybe cut:** Hero parallax (subtle)
4. **Maybe cut:** Custom cursor (nice to have)
5. **Never cut:** Magnetic buttons (signature effect)
