# Story 3.7: i18n QA & Polish

**Epic:** AITELIER-3.0-I18N
**Status:** Draft
**Priority:** P1
**Estimate:** 2-3 hours
**Depends on:** All previous stories (3.1-3.6)

---

## Story

**As a** user,
**I want** a polished bilingual experience without bugs or missing content,
**so that** I can browse the site confidently in either language.

---

## Acceptance Criteria

1. No missing translation warnings in console
2. All pages tested in both languages
3. All forms functional in both languages
4. Mobile responsive in both languages
5. SEO meta tags for both languages
6. Lighthouse performance > 85
7. Cross-browser testing (Chrome, Safari, Firefox)
8. Edge cases handled (fallbacks, errors)
9. Documentation complete

---

## Tasks / Subtasks

- [ ] **Console audit** (AC: 1)
  - [ ] Check for missing translation keys
  - [ ] Fix any i18next warnings
  - [ ] Verify fallback behavior

- [ ] **Page-by-page testing** (AC: 2)
  - [ ] Home (PT/EN)
  - [ ] Campo/Atelier (PT/EN)
  - [ ] Studio (PT/EN)
  - [ ] Estudos/School (PT/EN)
  - [ ] Archive (PT/EN)
  - [ ] Contact (PT/EN)
  - [ ] 404 page (PT/EN)

- [ ] **Form testing** (AC: 3)
  - [ ] Contact form labels (PT/EN)
  - [ ] Placeholders (PT/EN)
  - [ ] Validation messages (PT/EN)
  - [ ] Success/error toasts (PT/EN)
  - [ ] Newsletter subscription

- [ ] **Responsive testing** (AC: 4)
  - [ ] Mobile navigation toggle
  - [ ] Mobile language switcher
  - [ ] Text fitting in containers
  - [ ] No overflow issues

- [ ] **SEO implementation** (AC: 5)
  - [ ] hreflang tags on all pages
  - [ ] Canonical URLs
  - [ ] Meta titles per language
  - [ ] Meta descriptions per language
  - [ ] Open Graph tags per language

- [ ] **Performance audit** (AC: 6)
  - [ ] Lighthouse score check
  - [ ] Translation file bundle size
  - [ ] Lazy loading verification
  - [ ] First contentful paint

- [ ] **Cross-browser testing** (AC: 7)
  - [ ] Chrome (desktop/mobile)
  - [ ] Safari (desktop/mobile)
  - [ ] Firefox (desktop)
  - [ ] Edge (desktop)

- [ ] **Edge case handling** (AC: 8)
  - [ ] Invalid language in URL
  - [ ] Missing translation fallback
  - [ ] API errors during translation
  - [ ] localStorage unavailable
  - [ ] Browser language detection

- [ ] **Documentation** (AC: 9)
  - [ ] Update README with i18n section
  - [ ] Translation workflow guide
  - [ ] Adding new translations guide
  - [ ] Troubleshooting common issues

---

## Dev Notes

### SEO Meta Tags Implementation

```typescript
// src/components/SEOHead.tsx
import { Helmet } from 'react-helmet-async';
import { useTranslation } from 'react-i18next';
import { useParams, useLocation } from 'react-router-dom';

const BASE_URL = 'https://aitelier.com';

export function SEOHead() {
  const { t, i18n } = useTranslation('seo');
  const { lang } = useParams<{ lang: string }>();
  const location = useLocation();

  const currentUrl = `${BASE_URL}${location.pathname}`;
  const alternateLang = lang === 'pt' ? 'en' : 'pt';
  const alternatePath = location.pathname.replace(`/${lang}`, `/${alternateLang}`);
  const alternateUrl = `${BASE_URL}${alternatePath}`;

  return (
    <Helmet>
      <html lang={i18n.language} />
      <title>{t('title')}</title>
      <meta name="description" content={t('description')} />

      {/* hreflang tags */}
      <link rel="alternate" hreflang="pt-BR" href={lang === 'pt' ? currentUrl : alternateUrl} />
      <link rel="alternate" hreflang="en-US" href={lang === 'en' ? currentUrl : alternateUrl} />
      <link rel="alternate" hreflang="x-default" href={`${BASE_URL}/pt/`} />

      {/* Canonical */}
      <link rel="canonical" href={currentUrl} />

      {/* Open Graph */}
      <meta property="og:locale" content={i18n.language} />
      <meta property="og:locale:alternate" content={alternateLang === 'pt' ? 'pt_BR' : 'en_US'} />
      <meta property="og:title" content={t('title')} />
      <meta property="og:description" content={t('description')} />
    </Helmet>
  );
}
```

### SEO Translations File

```json
// src/i18n/locales/pt-BR/seo.json
{
  "home": {
    "title": "AI.TELIER — Campo Fundacional para a Era da IA",
    "description": "Um campo de experimentação artística onde humanos e IA co-criam."
  },
  "studio": {
    "title": "Studio — AI.TELIER",
    "description": "Produção audiovisual que une tecnologia ancestral e futura."
  },
  "contact": {
    "title": "Contato — AI.TELIER",
    "description": "Entre em contato com o AI.TELIER."
  }
}

// src/i18n/locales/en-US/seo.json
{
  "home": {
    "title": "AI.TELIER — Foundational Field for the AI Era",
    "description": "An artistic experimentation field where humans and AI co-create."
  },
  "studio": {
    "title": "Studio — AI.TELIER",
    "description": "Audiovisual production bridging ancestral and future technology."
  },
  "contact": {
    "title": "Contact — AI.TELIER",
    "description": "Get in touch with AI.TELIER."
  }
}
```

### Testing Checklist Template

```markdown
## Page: [Page Name]

### PT-BR
- [ ] All text displays correctly
- [ ] No missing translations
- [ ] Forms work
- [ ] Links navigate correctly
- [ ] Mobile layout correct

### EN-US
- [ ] All text displays correctly
- [ ] No missing translations
- [ ] Forms work
- [ ] Links navigate correctly
- [ ] Mobile layout correct

### Cross-check
- [ ] Toggle switches correctly
- [ ] URL updates properly
- [ ] No console errors
```

### Bundle Size Check

```bash
# Check translation file sizes
du -h src/i18n/locales/**/*.json

# Verify lazy loading
npm run build
# Check chunks in dist/
```

### Common Issues & Fixes

| Issue | Solution |
|-------|----------|
| Missing translation key | Add key to both locale files |
| Translation not updating | Clear localStorage, hard refresh |
| Route not found after switch | Check route mapping in LocalizedRoutes |
| Meta tags not updating | Verify Helmet is above Router |
| Performance drop | Enable namespace lazy loading |

---

## Testing Scenarios

### Edge Case Tests

1. **Direct URL access:**
   - `/en/contact` → English contact page
   - `/pt/escola` → Portuguese escola page

2. **Invalid language:**
   - `/fr/` → Redirect to `/pt/`
   - `/xyz/studio` → Redirect to `/pt/studio`

3. **localStorage unavailable:**
   - Still functions using URL language
   - No console errors

4. **Slow network:**
   - Translation files load before render
   - No flash of untranslated content

5. **SEO verification:**
   - Google Search Console validation
   - hreflang test with online tools

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-02 | 1.0 | Story created | PO Agent |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_
