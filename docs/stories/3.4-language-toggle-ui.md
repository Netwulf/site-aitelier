# Story 3.4: Language Toggle UI

**Epic:** AITELIER-3.0-I18N
**Status:** Draft
**Priority:** P0
**Estimate:** 2-3 hours
**Depends on:** 3.1, 3.3

---

## Story

**As a** user,
**I want** a simple language toggle in the navigation,
**so that** I can easily switch between Portuguese and English.

---

## Acceptance Criteria

1. Toggle visible in Navigation (desktop and mobile)
2. Shows current language clearly (PT / EN)
3. Clicking switches language immediately
4. URL updates to reflect new language
5. Preference persisted in localStorage
6. Smooth transition animation
7. Accessible (keyboard, screen readers)
8. Matches site's brutalist aesthetic

---

## Tasks / Subtasks

- [ ] **Create LanguageToggle component** (AC: 1, 2, 8)
  - [ ] Create `src/components/LanguageToggle.tsx`
  - [ ] Design brutalist toggle style
  - [ ] Show PT | EN with active state
  - [ ] Match existing nav typography

- [ ] **Implement toggle logic** (AC: 3, 4)
  - [ ] Connect to i18next changeLanguage
  - [ ] Use `useLocalizedNavigate` for URL update
  - [ ] Handle current route translation

- [ ] **Add persistence** (AC: 5)
  - [ ] Save preference to localStorage
  - [ ] Read on initial load
  - [ ] Sync with URL (URL takes precedence)

- [ ] **Add animation** (AC: 6)
  - [ ] Subtle hover effect
  - [ ] Click feedback
  - [ ] Optional: page transition fade

- [ ] **Integrate into Navigation** (AC: 1)
  - [ ] Add to desktop nav
  - [ ] Add to mobile menu
  - [ ] Position appropriately

- [ ] **Accessibility** (AC: 7)
  - [ ] Proper aria-labels
  - [ ] Keyboard navigation
  - [ ] Focus states
  - [ ] Screen reader text

- [ ] **Mobile considerations**
  - [ ] Touch-friendly size
  - [ ] Position in mobile menu
  - [ ] Clear visual feedback

---

## Dev Notes

### Design Specifications

```
Desktop:
┌─────────────────────────────────────────────────────────┐
│ LOGO       WORK   STUDIO   JOURNAL   CONTACT   [PT|EN] │
└─────────────────────────────────────────────────────────┘

Mobile Menu:
┌─────────────┐
│ WORK        │
│ STUDIO      │
│ JOURNAL     │
│ CONTACT     │
│ ─────────── │
│ [PT] • EN   │
└─────────────┘
```

### Component Implementation

```typescript
// src/components/LanguageToggle.tsx
import { useTranslation } from 'react-i18next';
import { useNavigate, useParams, useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';

const LANG_MAP = {
  'pt-BR': 'pt',
  'en-US': 'en',
} as const;

const ROUTE_MAP: Record<string, Record<string, string>> = {
  pt: {
    '/escola': '/school',
    '/contato': '/contact',
    '/arquivo': '/archive',
  },
  en: {
    '/school': '/escola',
    '/contact': '/contato',
    '/archive': '/arquivo',
  },
};

export function LanguageToggle({ className }: { className?: string }) {
  const { i18n } = useTranslation();
  const navigate = useNavigate();
  const { lang } = useParams<{ lang: string }>();
  const location = useLocation();

  const currentLang = lang || 'pt';
  const isPortuguese = currentLang === 'pt';

  const handleSwitch = () => {
    const newLang = isPortuguese ? 'en' : 'pt';
    const currentPath = location.pathname.replace(`/${currentLang}`, '');

    // Translate route if needed
    const translatedPath = ROUTE_MAP[currentLang]?.[currentPath] || currentPath;

    navigate(`/${newLang}${translatedPath}`, { replace: true });
  };

  return (
    <button
      onClick={handleSwitch}
      className={cn(
        'flex items-center gap-1 font-mono text-sm uppercase tracking-wider',
        'hover:opacity-70 transition-opacity',
        className
      )}
      aria-label={isPortuguese ? 'Switch to English' : 'Mudar para Português'}
    >
      <span className={cn(isPortuguese && 'font-bold')}>PT</span>
      <span className="opacity-50">|</span>
      <span className={cn(!isPortuguese && 'font-bold')}>EN</span>
    </button>
  );
}
```

### Brutalist Style Options

**Option A: Minimal**
```css
PT | EN
/* Active lang is bold, inactive is light */
```

**Option B: Box Toggle**
```css
[PT] EN  →  PT [EN]
/* Active lang has border/box */
```

**Option C: Underline**
```css
PT̲  EN  →  PT  EN̲
/* Active lang is underlined */
```

### LocalStorage Key
```typescript
const LANG_STORAGE_KEY = 'aitelier-language';

// Save
localStorage.setItem(LANG_STORAGE_KEY, 'pt-BR');

// Read
const saved = localStorage.getItem(LANG_STORAGE_KEY);
```

### Accessibility Requirements

```typescript
<button
  onClick={handleSwitch}
  aria-label={t('toggle.switchTo', { lang: isPortuguese ? 'English' : 'Português' })}
  aria-pressed={!isPortuguese}
  role="switch"
>
```

### Animation with Framer Motion (Optional)

```typescript
import { motion } from 'framer-motion';

<motion.button
  whileHover={{ scale: 1.05 }}
  whileTap={{ scale: 0.95 }}
  onClick={handleSwitch}
>
  ...
</motion.button>
```

---

## Testing Checklist

- [ ] Desktop: Toggle visible and clickable
- [ ] Mobile: Toggle in menu, touch-friendly
- [ ] Click PT → EN: URL changes, content changes
- [ ] Click EN → PT: URL changes, content changes
- [ ] Refresh page: Language persists
- [ ] New tab: Respects localStorage
- [ ] Keyboard: Can focus and activate
- [ ] Screen reader: Announces state correctly

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-02 | 1.0 | Story created | PO Agent |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_
