# Story 3.1: i18n Foundation Setup

**Epic:** AITELIER-3.0-I18N
**Status:** Done
**Priority:** P0
**Estimate:** 3-4 hours

---

## Story

**As a** developer,
**I want** a properly configured i18n foundation with TypeScript support,
**so that** I can start extracting content and adding translations safely.

---

## Acceptance Criteria

1. i18next and react-i18next installed and configured
2. Language detection working (path > localStorage > browser)
3. TypeScript types generated for translation keys
4. LanguageContext provider wrapping the app
5. Fallback language set to PT-BR
6. Folder structure created for locales
7. Basic translation hook working in at least one component

---

## Tasks / Subtasks

- [x] **Install dependencies** (AC: 1)
  - [x] `npm install i18next react-i18next i18next-browser-languagedetector`
  - [x] `npm install -D @types/i18next`

- [x] **Create i18n configuration** (AC: 1, 2, 5)
  - [x] Create `src/i18n/index.ts`
  - [x] Configure language detection order
  - [x] Set fallback to pt-BR
  - [x] Configure namespaces

- [x] **Create folder structure** (AC: 6)
  - [x] Create `src/i18n/locales/pt-BR/`
  - [x] Create `src/i18n/locales/en-US/`
  - [x] Create `common.json` in both

- [x] **Create LanguageContext** (AC: 4)
  - [x] Create `src/contexts/LanguageContext.tsx`
  - [x] Expose current language and setter
  - [x] Sync with i18next

- [x] **Setup TypeScript types** (AC: 3)
  - [x] Create `src/i18n/types.ts`
  - [x] Define translation key structure
  - [x] Configure module augmentation for type safety

- [x] **Integrate with App** (AC: 4, 7)
  - [x] Wrap App with I18nextProvider
  - [x] Wrap with LanguageContext
  - [x] Test hook in Navigation component

- [x] **Verify setup** (AC: 7)
  - [x] Console log current language
  - [x] Translate one menu item as proof
  - [x] Confirm no console errors

---

## Dev Notes

### Dependencies to Install
```bash
npm install i18next react-i18next i18next-browser-languagedetector
```

### i18n Configuration Reference
```typescript
// src/i18n/index.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// Import locale files
import ptBRCommon from './locales/pt-BR/common.json';
import enUSCommon from './locales/en-US/common.json';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources: {
      'pt-BR': { common: ptBRCommon },
      'en-US': { common: enUSCommon },
    },
    fallbackLng: 'pt-BR',
    supportedLngs: ['pt-BR', 'en-US'],
    defaultNS: 'common',
    interpolation: {
      escapeValue: false, // React already escapes
    },
    detection: {
      order: ['path', 'localStorage', 'navigator'],
      lookupFromPathIndex: 0,
      caches: ['localStorage'],
    },
  });

export default i18n;
```

### TypeScript Module Augmentation
```typescript
// src/i18n/types.ts
import 'i18next';
import common from './locales/pt-BR/common.json';

declare module 'i18next' {
  interface CustomTypeOptions {
    defaultNS: 'common';
    resources: {
      common: typeof common;
    };
  }
}
```

### Folder Structure
```
src/i18n/
├── index.ts                    # Main config
├── types.ts                    # TypeScript types
├── locales/
│   ├── pt-BR/
│   │   └── common.json         # Initial: nav, footer, buttons
│   └── en-US/
│       └── common.json         # Translated version
```

### Initial common.json Structure
```json
{
  "nav": {
    "work": "WORK",
    "studio": "STUDIO",
    "journal": "JOURNAL",
    "contact": "CONTATO"
  },
  "footer": {
    "newsletter": "Newsletter",
    "subscribe": "Inscrever",
    "rights": "Todos os direitos reservados"
  },
  "buttons": {
    "send": "Enviar",
    "loading": "Enviando...",
    "close": "Fechar"
  }
}
```

### Testing Standards

- No unit tests required for this story (config only)
- Manual verification:
  1. Check console for i18next initialization logs
  2. Verify `useTranslation()` hook returns correct values
  3. Confirm language detection from browser
  4. Test localStorage persistence

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-02 | 1.0 | Story created | PO Agent |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
Build verified: `npm run build` passed successfully

### Completion Notes List
- Installed i18next, react-i18next, i18next-browser-languagedetector
- Also installed react-intersection-observer (missing dep found during build)
- Created complete i18n folder structure
- Configured language detection: path > localStorage > navigator
- TypeScript types with module augmentation
- LanguageContext with toggle and sync utilities
- Integrated with App.tsx (wrapped with LanguageProvider)

### File List
- `src/i18n/index.ts` (created)
- `src/i18n/types.ts` (created)
- `src/i18n/locales/pt-BR/common.json` (created)
- `src/i18n/locales/en-US/common.json` (created)
- `src/contexts/LanguageContext.tsx` (created)
- `src/main.tsx` (modified - added i18n import)
- `src/App.tsx` (modified - added LanguageProvider)
- `package.json` (modified - new dependencies)
