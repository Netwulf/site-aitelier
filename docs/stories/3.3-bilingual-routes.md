# Story 3.3: Bilingual Routes Implementation

**Epic:** AITELIER-3.0-I18N
**Status:** Draft
**Priority:** P0
**Estimate:** 2-3 hours
**Depends on:** 3.1

---

## Story

**As a** user,
**I want** to access the site in my preferred language via URL,
**so that** I can share language-specific links and have consistent navigation.

---

## Acceptance Criteria

1. Routes support language prefix (`/pt/*`, `/en/*`)
2. Root `/` redirects to `/pt/` (default language)
3. Language changes update URL without page reload
4. Navigating between pages preserves language
5. Direct URL access works (e.g., `/en/contact`)
6. Invalid language prefix shows 404 or redirects
7. SEO-friendly hreflang tags implemented

---

## Tasks / Subtasks

- [ ] **Create LocalizedRoutes wrapper** (AC: 1, 4)
  - [ ] Create `src/components/LocalizedRoutes.tsx`
  - [ ] Extract language from URL path
  - [ ] Sync language with i18next
  - [ ] Pass through to child routes

- [ ] **Update App.tsx routing** (AC: 1, 2)
  - [ ] Add `/:lang` prefix to all routes
  - [ ] Add redirect from `/` to `/pt/`
  - [ ] Handle nested routes properly
  - [ ] Maintain existing route structure

- [ ] **Route mapping table** (AC: 1, 5)
  ```
  /pt/             -> Home (PT)
  /en/             -> Home (EN)
  /pt/atelier      -> Campo (PT) - keep brand name
  /en/atelier      -> Campo (EN) - keep brand name
  /pt/escola       -> Estudos (PT)
  /en/school       -> Estudos (EN)
  /pt/studio       -> Studio (PT)
  /en/studio       -> Studio (EN)
  /pt/contato      -> Contact (PT)
  /en/contact      -> Contact (EN)
  /pt/arquivo      -> Archive (PT)
  /en/archive      -> Archive (EN)
  ```

- [ ] **Create useLocalizedNavigate hook** (AC: 3, 4)
  - [ ] Create `src/hooks/useLocalizedNavigate.ts`
  - [ ] Preserve current language when navigating
  - [ ] Handle language switch navigation

- [ ] **Update all Link components** (AC: 4)
  - [ ] Replace hardcoded paths with localized versions
  - [ ] Use `useLocalizedNavigate` for programmatic navigation
  - [ ] Update Navigation component links
  - [ ] Update Footer links

- [ ] **Handle edge cases** (AC: 6)
  - [ ] Invalid language prefix → redirect to /pt/
  - [ ] Old routes without prefix → redirect with language
  - [ ] 404 page localized

- [ ] **Implement SEO tags** (AC: 7)
  - [ ] Add hreflang link tags
  - [ ] Add canonical URL handling
  - [ ] Update document title per language

---

## Dev Notes

### Route Structure

```typescript
// src/App.tsx
<Routes>
  {/* Redirect root to default language */}
  <Route path="/" element={<Navigate to="/pt/" replace />} />

  {/* Localized routes */}
  <Route path="/:lang" element={<LocalizedRoutes />}>
    <Route index element={<Home />} />
    <Route path="atelier" element={<Campo />} />
    <Route path="escola" element={<Estudos />} />
    <Route path="school" element={<Estudos />} />
    <Route path="studio" element={<Studio />} />
    <Route path="contato" element={<Contact />} />
    <Route path="contact" element={<Contact />} />
    <Route path="arquivo" element={<Archive />} />
    <Route path="archive" element={<Archive />} />
    <Route path="*" element={<NotFound />} />
  </Route>
</Routes>
```

### LocalizedRoutes Component
```typescript
// src/components/LocalizedRoutes.tsx
import { useParams, Outlet, Navigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { useEffect } from 'react';

const SUPPORTED_LANGS = ['pt', 'en'];

export function LocalizedRoutes() {
  const { lang } = useParams<{ lang: string }>();
  const { i18n } = useTranslation();

  // Validate language
  if (!lang || !SUPPORTED_LANGS.includes(lang)) {
    return <Navigate to="/pt/" replace />;
  }

  // Sync i18next with URL language
  useEffect(() => {
    const locale = lang === 'en' ? 'en-US' : 'pt-BR';
    if (i18n.language !== locale) {
      i18n.changeLanguage(locale);
    }
  }, [lang, i18n]);

  return <Outlet />;
}
```

### useLocalizedNavigate Hook
```typescript
// src/hooks/useLocalizedNavigate.ts
import { useNavigate, useParams } from 'react-router-dom';
import { useCallback } from 'react';

export function useLocalizedNavigate() {
  const navigate = useNavigate();
  const { lang } = useParams<{ lang: string }>();

  const localizedNavigate = useCallback(
    (path: string, options?: { replace?: boolean }) => {
      const localizedPath = `/${lang}${path.startsWith('/') ? path : `/${path}`}`;
      navigate(localizedPath, options);
    },
    [navigate, lang]
  );

  return localizedNavigate;
}
```

### Link Update Pattern
```typescript
// Before
<Link to="/studio">Studio</Link>

// After
import { useParams } from 'react-router-dom';
const { lang } = useParams();
<Link to={`/${lang}/studio`}>Studio</Link>

// Or using helper
import { useLocalizedLink } from '@/hooks/useLocalizedLink';
const { createLink } = useLocalizedLink();
<Link to={createLink('/studio')}>Studio</Link>
```

### Hreflang Implementation
```typescript
// In Head/Helmet component
<link rel="alternate" hreflang="pt-BR" href="https://aitelier.com/pt/" />
<link rel="alternate" hreflang="en-US" href="https://aitelier.com/en/" />
<link rel="alternate" hreflang="x-default" href="https://aitelier.com/pt/" />
```

### Testing Checklist

- [ ] `/` → redirects to `/pt/`
- [ ] `/pt/` → renders home in Portuguese
- [ ] `/en/` → renders home in English
- [ ] `/pt/studio` → works
- [ ] `/en/studio` → works
- [ ] `/fr/` (invalid) → redirects to `/pt/`
- [ ] Clicking nav link preserves language
- [ ] Browser back/forward works
- [ ] Direct URL access works

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-02 | 1.0 | Story created | PO Agent |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_
