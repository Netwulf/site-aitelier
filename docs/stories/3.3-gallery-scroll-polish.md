# Story 3.3: Gallery & Scroll Polish

**Story ID:** AITELIER-3.3
**Epic:** 3.0 - UX Polish Framer/Apple
**Priority:** P1
**Estimate:** 5-6 hours
**Status:** Ready for Development
**Depends on:** Story 3.1 (uses useScrollReveal hook)

---

## User Story

**As a** visitor browsing the gallery and scrolling through pages
**I want** images and sections to elegantly reveal as I scroll
**So that** the browsing experience feels cinematic and intentional

---

## Acceptance Criteria

### AC1: Gallery Images Scroll Reveal
- [ ] Images fade in as they enter viewport
- [ ] Stagger effect: each image delays 30ms after previous
- [ ] Animation: opacity 0→1, translateY 20px→0, scale 0.95→1
- [ ] Duration: 400ms per image
- [ ] Only animates once (no re-trigger on scroll up)

### AC2: Image Hover Brightness
- [ ] Gallery images have brightness boost on hover (1.1)
- [ ] Slight saturation increase
- [ ] Smooth 300ms transition
- [ ] Grain overlay remains visible

### AC3: Modal Spring Physics
- [ ] Image modal opens with spring animation
- [ ] Image scales from 0.9 to 1 with bounce
- [ ] Background fades in with blur
- [ ] Close animation: scale down + fade out
- [ ] Spring config: stiffness 300, damping 25

### AC4: Scroll Progress Indicator
- [ ] Thin line at top of page showing scroll progress
- [ ] Color: tech-olive
- [ ] Height: 2px
- [ ] Smooth real-time update
- [ ] Only visible after first 100px of scroll

### AC5: Section Reveals Enhanced
- [ ] Each major section has unique reveal
- [ ] Text sections: slide from left
- [ ] Image sections: fade with scale
- [ ] Cards: stagger from bottom
- [ ] Duration: 600-800ms depending on type

---

## Technical Implementation

### Task 1: Gallery Images Scroll Reveal

**File:** `src/components/VisualArchiveGrid.tsx`

```tsx
import { useInView } from "framer-motion";
import { useRef } from "react";

// Inside the map function for each image
const ImageReveal = ({ image, index, onClick, likeCount, modalId }: Props) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, margin: "-50px" });
  const prefersReducedMotion = useReducedMotion();

  return (
    <motion.div
      ref={ref}
      key={`${image.category}-${index}`}
      initial={prefersReducedMotion ? {} : { opacity: 0, y: 20, scale: 0.95 }}
      animate={
        prefersReducedMotion
          ? {}
          : isInView
          ? { opacity: 1, y: 0, scale: 1 }
          : {}
      }
      transition={{
        duration: 0.4,
        delay: prefersReducedMotion ? 0 : (index % 8) * 0.03, // Stagger within viewport batch
        ease: [0.4, 0, 0.2, 1],
      }}
      className="break-inside-avoid group cursor-pointer"
      onClick={() => onClick(index)}
    >
      {/* ... existing content ... */}
    </motion.div>
  );
};
```

---

### Task 2: Image Hover Brightness

**File:** `src/components/VisualArchiveGrid.tsx`

```tsx
// Update the img element
<img
  src={image.src}
  alt={image.title}
  loading="lazy"
  className="w-full transition-all duration-300 ease-out
            filter contrast-110 saturate-90
            group-hover:brightness-110 group-hover:saturate-100
            group-hover:scale-105"
  onError={(e) => {
    e.currentTarget.style.display = "none";
  }}
/>
```

**File:** `src/index.css` (optional utility)

```css
/* Image hover treatment */
.img-hover-bright {
  transition: filter 0.3s ease-out, transform 0.5s ease-out;
}

.img-hover-bright:hover {
  filter: brightness(1.1) saturate(1.05) contrast(1.05);
}
```

---

### Task 3: Modal Spring Physics

**File:** `src/components/ImageModal.tsx`

```tsx
// Update animation variants
const backdropVariants = {
  hidden: { opacity: 0, backdropFilter: "blur(0px)" },
  visible: {
    opacity: 1,
    backdropFilter: "blur(8px)",
    transition: { duration: 0.2 }
  },
  exit: {
    opacity: 0,
    backdropFilter: "blur(0px)",
    transition: { duration: 0.15 }
  }
};

const imageVariants = {
  hidden: { opacity: 0, scale: 0.9 },
  visible: {
    opacity: 1,
    scale: 1,
    transition: {
      type: "spring",
      stiffness: 300,
      damping: 25,
    }
  },
  exit: {
    opacity: 0,
    scale: 0.95,
    transition: { duration: 0.15 }
  }
};

// In the component
<motion.div
  initial="hidden"
  animate="visible"
  exit="exit"
  variants={backdropVariants}
  // ... backdrop element
>
  <motion.img
    key={currentImage.src}
    variants={imageVariants}
    initial="hidden"
    animate={imageLoaded ? "visible" : "hidden"}
    exit="exit"
    // ... rest of props
  />
</motion.div>
```

---

### Task 4: Scroll Progress Indicator

**File:** `src/hooks/useScrollProgress.ts` (NEW)

```tsx
import { useState, useEffect } from "react";

export const useScrollProgress = () => {
  const [progress, setProgress] = useState(0);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = (scrollTop / docHeight) * 100;

      setProgress(scrollPercent);
      setIsVisible(scrollTop > 100);
    };

    window.addEventListener("scroll", handleScroll, { passive: true });
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  return { progress, isVisible };
};
```

**File:** `src/components/ScrollProgress.tsx` (NEW)

```tsx
import { useScrollProgress } from "@/hooks/useScrollProgress";
import { motion, AnimatePresence } from "framer-motion";

export const ScrollProgress = () => {
  const { progress, isVisible } = useScrollProgress();

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed top-0 left-0 right-0 h-0.5 z-[100] pointer-events-none"
        >
          <div
            className="h-full bg-tech-olive"
            style={{
              width: `${progress}%`,
              transition: "width 0.1s ease-out",
            }}
          />
        </motion.div>
      )}
    </AnimatePresence>
  );
};
```

**File:** `src/App.tsx` - Add component

```tsx
import { ScrollProgress } from "@/components/ScrollProgress";

// In the return
<>
  <ScrollProgress />
  {/* rest of app */}
</>
```

---

### Task 5: Section Reveals Enhanced

**File:** `src/utils/sectionVariants.ts` (NEW)

```tsx
export const sectionVariants = {
  // For text-heavy sections - slide from left
  textSlide: {
    hidden: { opacity: 0, x: -30 },
    visible: {
      opacity: 1,
      x: 0,
      transition: { duration: 0.6, ease: [0.4, 0, 0.2, 1] }
    }
  },

  // For image sections - fade with scale
  imageReveal: {
    hidden: { opacity: 0, scale: 0.98 },
    visible: {
      opacity: 1,
      scale: 1,
      transition: { duration: 0.8, ease: [0.4, 0, 0.2, 1] }
    }
  },

  // For card grids - stagger from bottom
  cardContainer: {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.1
      }
    }
  },

  cardItem: {
    hidden: { opacity: 0, y: 30 },
    visible: {
      opacity: 1,
      y: 0,
      transition: { duration: 0.5, ease: [0.4, 0, 0.2, 1] }
    }
  },

  // Generic fade up
  fadeUp: {
    hidden: { opacity: 0, y: 20 },
    visible: {
      opacity: 1,
      y: 0,
      transition: { duration: 0.6, ease: [0.4, 0, 0.2, 1] }
    }
  }
};
```

**Usage in page sections:**

```tsx
import { motion } from "framer-motion";
import { useInView } from "framer-motion";
import { sectionVariants } from "@/utils/sectionVariants";

const TextSection = () => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, margin: "-100px" });

  return (
    <motion.section
      ref={ref}
      variants={sectionVariants.textSlide}
      initial="hidden"
      animate={isInView ? "visible" : "hidden"}
    >
      {/* content */}
    </motion.section>
  );
};
```

---

## Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/hooks/useScrollProgress.ts` | CREATE | Scroll percentage hook |
| `src/components/ScrollProgress.tsx` | CREATE | Progress bar component |
| `src/utils/sectionVariants.ts` | CREATE | Reusable animation variants |
| `src/components/VisualArchiveGrid.tsx` | MODIFY | Image reveal + brightness |
| `src/components/ImageModal.tsx` | MODIFY | Spring physics |
| `src/App.tsx` | MODIFY | Add ScrollProgress |
| `src/pages/Index.tsx` | MODIFY | Apply section variants |

---

## Testing Checklist

- [ ] Gallery images reveal on scroll
- [ ] Stagger timing feels natural
- [ ] Image brightness hover works
- [ ] Modal opens with spring bounce
- [ ] Modal closes smoothly
- [ ] Progress bar updates smoothly
- [ ] Progress bar hidden at top
- [ ] Section reveals trigger correctly
- [ ] No layout shifts (CLS)
- [ ] Performance on mobile gallery (many images)

---

## Definition of Done

- [ ] All 5 acceptance criteria met
- [ ] Animations feel cinematic, not distracting
- [ ] Performance tested with 50+ gallery images
- [ ] Respects `prefers-reduced-motion`
- [ ] Lighthouse performance > 85

---

## Notes

- Gallery stagger uses modulo to reset delay for visible batch
- Modal backdrop blur can be expensive - test on older devices
- Progress bar should feel instant, not sluggish
- Section variants are reusable across all pages

---

**Estimate breakdown:**
- Task 1 (Gallery reveal): 1.5 hours
- Task 2 (Brightness hover): 30 min
- Task 3 (Modal spring): 1 hour
- Task 4 (Scroll progress): 1 hour
- Task 5 (Section variants): 1.5 hours
- Testing & polish: 1 hour

**Total: ~6 hours**
